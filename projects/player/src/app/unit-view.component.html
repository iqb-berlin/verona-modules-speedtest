<div class="outer-wrapper" [ngClass]="{'numbers-row': unit.answerType === 'number' && unit.layout == 'row'}">
    @if (unit.instructionText) {
        <p class="instruction-text">{{ unit.instructionText }}</p>
    }
    <div class="inner-wrapper" [ngClass]="innerWrapperClasses">
        <div class="question"
             [style.height.%]="unit.layout == 'column' && unit.questionSpaceRatio"
             [style.width.%]="unit.layout == 'row' && unit.questionSpaceRatio">
            @if (unit.questionType === 'text') {
                <p>{{ question.text }}</p>
            }
            @if (unit.questionType === 'image') {
                <figure class="text-image-wrapper">
                    <img *ngIf="question.src" [src]="question.src" [alt]="question.text">
                    @if (question.text) {
                        <figcaption>{{ question.text }}</figcaption>
                    }
                </figure>
            }
            @if (unit.questionType === 'audio') {
                <div>
                    <audio #audioElement [src]=question.src
                           (play)="isAudioActive = true" (ended)="isAudioActive = false"></audio>
                    <button class="audio-button large-audio-button" [class.in-progress]="isAudioActive"
                            [disabled]="isAudioActive" (click)="audioElement.play();">
                            <ng-container *ngTemplateOutlet="audioIcon"></ng-container>
                    </button>
                    <p>{{ question.text }}</p>
                </div>
            }
            @if (unit.questionType === 'word-select') {
                <p>
                    @if (question.src !== undefined) {
                      <audio #audioElement [src]=question.src
                             (play)="isAudioActive = true" (ended)="isAudioActive = false"></audio>
                      <button class="audio-button" [class.in-progress]="isAudioActive"
                              [disabled]="isAudioActive" (click)="audioElement.play();">
                              <ng-container *ngTemplateOutlet="audioIcon"></ng-container>
                      </button>
                    }
                    @for (word of textParts; track $index) {
                        <span [class.selected]="word.wordIndex !== undefined && selectedAnswers.includes(word.wordIndex)"
                              (click)="word.isSelectable && onAnswerClick($any(word.wordIndex))">
                            {{ word.text }}
                        </span>
                    }
                </p>
            }
            @if (unit.questionType === 'inline-answers') {
                @if (question.src !== undefined) {
                  <audio #audioElement [src]=question.src
                         (play)="isAudioActive = true" (ended)="isAudioActive = false"></audio>
                  <button class="audio-button" [class.in-progress]="isAudioActive"
                          [disabled]="isAudioActive" (click)="audioElement.play();">
                          <ng-container *ngTemplateOutlet="audioIcon"></ng-container>
                  </button>
                }
                <span>{{ textParts[0].text }}</span>
                <div class="inline-answer-buttons">
                    @for (answer of question.answers; let answerIndex = $index; track answerIndex) {
                        <button mat-raised-button [style.background-color]="unit.buttonColor"
                                (click)="onAnswerClick(answerIndex)">
                            {{ answer.text }}
                        </button>
                    }
                </div>
                <span>{{ textParts[1].text }}</span>
            }
        </div>
        @if (unit.questionType !== 'word-select' && unit.questionType !== 'inline-answers') {
            <div class="answers"
                 [style.height.%]="unit.layout == 'column' && unit.questionSpaceRatio && (100 - 3 - unit.questionSpaceRatio)"
                 [style.width.%]="unit.layout == 'row' && unit.questionSpaceRatio && (100 - 3 - unit.questionSpaceRatio)">
                @if (unit.answerType !== 'number') {
                    @for (answer of question.answers; let answerIndex = $index; track answerIndex) {
                        @if (unit.answerType === 'text') {
                            <button mat-raised-button [class.selected]="selectedAnswers.includes(answerIndex)"
                                    [style.background-color]="unit.buttonColor"
                                    [style.width.px]="unit.buttonWidth"
                                    (click)="onAnswerClick(answerIndex)">
                                @if (answer.splitPosition) {
                                    <span class="button-label-1">{{ (answer.text | splitWord: answer.splitPosition)[0] }}</span>
                                    <span class="button-label-2">{{ (answer.text | splitWord: answer.splitPosition)[1] }}</span>
                                } @else {
                                    {{ answer.text }}
                                }
                            </button>
                        } @else if (unit.answerType === 'image') {
                            <img [class.selected]="selectedAnswers.includes(answerIndex)"
                                 [src]="answer.src" (click)="onAnswerClick(answerIndex)">
                        } @else if (unit.answerType === 'audio') {
                            <div class="audio-button-wrapper">
                                <audio #audioRef [id]="'audioElement' + answerIndex" [src]=answer.src
                                       (play)="isAudioActive = true" (ended)="isAudioActive = false"></audio>
                                <button class="audio-button" [class.in-progress]="isAudioActive"
                                        [disabled]="isAudioActive" (click)="playAnswerAudio(answerIndex)">
                                        <ng-container *ngTemplateOutlet="audioIcon"></ng-container>
                                </button>
                                <button mat-raised-button [style.background-color]="unit.buttonColor"
                                        [style.width.px]="unit.buttonWidth"
                                        [class.selected]="selectedAnswers.includes(answerIndex)"
                                        (click)="onAnswerClick(answerIndex)">
                                    {{ answer.text }}
                                </button>
                            </div>
                        }
                    }
                } @else {
                    <div class="number-result-box-container">
                        @for (number of numberAnswer; track $index) {
                            <div class="number-result-box" [class.active]="$index === activeNumberIndex"
                                 (click)="selectResultBox($index)">
                                {{ number }}
                            </div>
                        }
                    </div>
               }
            </div>
        }
    </div>
    @if (unit.answerType === 'number') {
        <div class="number-buttons">
            @for (number of mathInputs; track number) {
                <button (click)="enterDigit(number)">
                    {{ number }}
                </button>
            }
            <button class="icon-button" (click)="deleteDigit()">
                <mat-icon>backspace</mat-icon>
            </button>
        </div>
    }
    @if (unit.answerType === 'number' || unit.multipleSelection || unit.questionType === 'word-select') {
        <div class="unit-nav-next">
          <button (click)="onNext()">
            <ng-container *ngTemplateOutlet="nextUnitIcon"></ng-container>
          </button>
        </div>
    }
</div>

<ng-template #audioIcon>
<svg width="85" height="85" viewBox="0 0 85 85" fill="none" version="1.1" id="svg6" sodipodi:docname="Ohr_mit_Schatten_neu.svg"
   inkscape:version="1.4 (86a8ad7, 2024-10-11)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
    <g inkscape:groupmode="layer" id="layer1" inkscape:label="Layer 1">
    <circle
       style="fill:#d1dfe3;fill-opacity:1;stroke:none;stroke-width:6.01129;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:normal"
       id="path7" cx="46.5" cy="46.5" r="38.5" />
    <circle style="fill:#196175;stroke-width:0;stroke-linecap:round;stroke-linejoin:round"
       id="path6" cy="40.000008" cx="40" r="40" />
    <path d="m 46.643342,35.214198 c -6.801527,0.801525 -4.626526,10.393039 1.785938,9.496026"
       style="stroke:#ffffff;stroke-width:3.20247;stroke-linecap:round;stroke-opacity:1"
       id="path1-0" />
    <path
       d="m 46.544351,55.679814 c -0.53122,0 -1.053216,-0.111845 -1.425982,-0.279818 -1.314163,-0.699392 -2.264887,-1.650385 -3.18763,-4.447952 -0.959948,-2.899905 -2.740146,-4.270574 -4.464485,-5.604132 -1.472514,-1.137675 -3.001093,-2.312665 -4.315256,-4.709164 -0.978704,-1.790243 -1.519148,-3.739359 -1.519148,-5.473577 0,-5.23128 4.091616,-9.324885 9.320288,-9.324885 4.594241,0 8.310733,3.160401 9.144922,7.476163 0.194942,1.008347 1.010067,1.848722 2.039608,1.848722 1.029438,0 1.877771,-0.837103 1.738996,-1.854651 -0.874777,-6.41128 -6.237509,-11.200085 -12.923424,-11.200085 -7.316451,0 -13.048567,5.734686 -13.048567,13.054736 0,2.359285 0.708328,4.942158 1.985184,7.273328 1.696358,3.086485 3.700196,4.625126 5.312613,5.874544 1.509924,1.165687 2.600346,2.005142 3.196854,3.813889 1.118402,3.385114 2.563038,5.296506 5.079544,6.620556 0.969378,0.438283 1.994613,0.66228 3.066483,0.66228 3.475635,0 6.404777,-2.39384 7.226462,-5.619365 0.253568,-0.995261 -0.60481,-1.840645 -1.634248,-1.840645 -1.02954,0 -1.825295,0.881882 -2.317055,1.784109 -0.632073,1.159553 -1.861372,1.945947 -3.275159,1.945947 z"
       fill="#101c61" id="path2-9" style="fill:#ffffff;fill-opacity:1;stroke:none;stroke-width:1.02364;stroke-opacity:1" />
    <path
       d="m 27.847609,24.679769 c 0.64222,-0.802547 0.651547,-1.973448 -0.07523,-2.700648 -0.729954,-0.730165 -1.923073,-0.735175 -2.583537,0.05807 -2.961223,3.556256 -4.741523,8.132105 -4.741523,13.128039 0,4.995934 1.7803,9.571885 4.741523,13.127937 0.660464,0.793244 1.853583,0.788336 2.583434,0.05807 0.726879,-0.7272 0.71745,-1.897999 0.07523,-2.700546 -2.300144,-2.87404 -3.672113,-6.51924 -3.672113,-10.485358 0,-3.966117 1.372071,-7.61142 3.672215,-10.485562 z"
       fill="#101c61" id="path1-4" style="fill:#ffffff;fill-opacity:1;stroke-width:1.02364" />
  </g>
  <defs id="defs6">
    <filter id="filter0_d_521_1064" x="0" y="0" width="85.821297" height="86.034203" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" id="feFlood4" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" id="feColorMatrix4" />
      <feMorphology radius="3.12851" operator="dilate" in="SourceAlpha" result="effect1_dropShadow_521_1064" id="feMorphology4" />
      <feOffset dx="4.69277" dy="4.69277" id="feOffset4" />
      <feComposite in2="hardAlpha" operator="out" id="feComposite4" />
      <feColorMatrix type="matrix" values="0 0 0 0 0.0627451 0 0 0 0 0.109804 0 0 0 0 0.380392 0 0 0 0.25 0" id="feColorMatrix5" />
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_521_1064" id="feBlend5" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_521_1064" result="shape" id="feBlend6" />
    </filter>
  </defs>
</svg></ng-template>

<ng-template #nextUnitIcon>
<svg width="80" height="80" viewBox="0 0 80 80" fill="none"
     version="1.1" id="svg4" sodipodi:docname="Pfeil_ohne_Schatten_neu.svg"
   inkscape:version="1.4 (86a8ad7, 2024-10-11)" inkscape:export-filename="Pfeil_ohne_Schatten.png"
   inkscape:export-xdpi="96" inkscape:export-ydpi="96"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg">
  <defs id="defs4">
    <filter id="filter0_d_816_483" x="0" y="0" width="79" height="79" filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB">
      <feFlood flood-opacity="0" result="BackgroundImageFix" id="feFlood2" />
      <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
         result="hardAlpha" id="feColorMatrix2" />
      <feMorphology radius="4" operator="dilate" in="SourceAlpha" result="effect1_dropShadow_816_483"
                    id="feMorphology2" />
      <feOffset dx="5" dy="5" id="feOffset2" />
      <feComposite in2="hardAlpha" operator="out" id="feComposite2" />
      <feColorMatrix type="matrix" values="0 0 0 0 0.678431 0 0 0 0 0.713726 0 0 0 0 0.843137 0 0 0 1 0"
                     id="feColorMatrix3" />
      <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_816_483"
               id="feBlend3" />
      <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_816_483" result="shape"
               id="feBlend4" />
    </filter>
  </defs>
  <circle style="fill:#196175;fill-opacity:1;stroke-width:0;stroke-linecap:round;stroke-linejoin:round"
          id="path4" cx="40" cy="39.999992" inkscape:label="path4" r="40" />
  <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:5.71429;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:normal"
        d="M 43.199998,54.857141 58.057141,39.999999 43.199998,25.142856" id="path5"
        sodipodi:nodetypes="ccc" />
  <path style="fill:none;fill-opacity:1;stroke:#ffffff;stroke-width:5.71429;stroke-linecap:round;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;paint-order:normal"
        d="m 21.942856,39.999999 c 11.42865,0.0663 22.857006,-0.05206 34.285713,0"
        id="path6" sodipodi:nodetypes="cc" />
</svg>
</ng-template>
